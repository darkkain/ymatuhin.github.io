(function(r){function H(){return"Markdown.mk_block( "+uneval(this.toString())+", "+uneval(this.trailing)+", "+uneval(this.lineNumber)+" )"}function I(){var b=require("util");return"Markdown.mk_block( "+b.inspect(this.toString())+", "+b.inspect(this.trailing)+", "+b.inspect(this.lineNumber)+" )"}function B(b){for(var c=0,d=-1;-1!==(d=b.indexOf("\n",d+1));)c++;return c}function w(b,c){function d(b){this.len_after=b;this.name="close_"+c}var e=b+"_state",f="strong"==b?"em_state":"strong_state";return function(h,
g){if(this[e][0]==c)return this[e].shift(),[h.length,new d(h.length-c.length)];var s=this[f].slice(),J=this[e].slice();this[e].unshift(c);var t=this.processInline(h.substr(c.length)),D=t[t.length-1];this[e].shift();if(D instanceof d)return t.pop(),[h.length-D.len_after,[b].concat(t)];this[f]=s;this[e]=J;return[c.length,c]}}function k(b){return u(b)&&1<b.length&&"object"===typeof b[1]&&!u(b[1])?b[1]:void 0}function E(b){return b.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,
"&quot;").replace(/'/g,"&#39;")}function x(b){if("string"===typeof b)return E(b);var c=b.shift(),d={},e=[];for(!b.length||"object"!==typeof b[0]||b[0]instanceof Array||(d=b.shift());b.length;)e.push(x(b.shift()));b="";for(var f in d)b+=" "+f+'="'+E(d[f])+'"';return"img"==c||"br"==c||"hr"==c?"<"+c+b+"/>":"<"+c+b+">"+e.join("")+"</"+c+">"}function F(b,c,d){var e;d=d||{};b=b.slice(0);"function"===typeof d.preprocessTreeNode&&(b=d.preprocessTreeNode(b,c));var f=k(b);if(f){b[1]={};for(e in f)b[1][e]=f[e];
f=b[1]}if("string"===typeof b)return b;switch(b[0]){case "header":b[0]="h"+b[1].level;delete b[1].level;break;case "bulletlist":b[0]="ul";break;case "numberlist":b[0]="ol";break;case "listitem":b[0]="li";break;case "para":b[0]="p";break;case "markdown":b[0]="html";f&&delete f.references;break;case "code_block":b[0]="pre";e=f?2:1;var h=["code"];h.push.apply(h,b.splice(e,b.length-e));b[e]=h;break;case "inlinecode":b[0]="code";break;case "img":b[1].src=b[1].href;delete b[1].href;break;case "linebreak":b[0]=
"br";break;case "link":b[0]="a";break;case "link_ref":b[0]="a";if(e=c[f.ref])delete f.ref,f.href=e.href,e.title&&(f.title=e.title),delete f.original;else return f.original;break;case "img_ref":if(b[0]="img",e=c[f.ref])delete f.ref,f.src=e.href,e.title&&(f.title=e.title),delete f.original;else return f.original}e=1;if(f){for(var g in b[1]){e=2;break}1===e&&b.splice(e,1)}for(;e<b.length;++e)b[e]=F(b[e],c,d);return b}function G(b){for(var c=k(b)?2:1;c<b.length;)"string"===typeof b[c]?c+1<b.length&&"string"===
typeof b[c+1]?b[c]+=b.splice(c+1,1)[0]:++c:(G(b[c]),++c)}var g=r.Markdown=function(b){switch(typeof b){case "undefined":this.dialect=g.dialects.Gruber;break;case "object":this.dialect=b;break;default:if(b in g.dialects)this.dialect=g.dialects[b];else throw Error("Unknown Markdown dialect '"+String(b)+"'");}this.em_state=[];this.strong_state=[];this.debug_indent=""};r.parse=function(b,c){return(new g(c)).toTree(b)};r.toHTML=function(b,c,d){b=r.toHTMLTree(b,c,d);return r.renderJsonML(b)};r.toHTMLTree=
function(b,c,d){"string"===typeof b&&(b=this.parse(b,c));c=k(b);var e={};c&&c.references&&(e=c.references);b=F(b,e,d);G(b);return b};var l=g.mk_block=function(b,c,d){1==arguments.length&&(c="\n\n");var e=new String(b);e.trailing=c;e.inspect=I;e.toSource=H;void 0!=d&&(e.lineNumber=d);return e};g.prototype.split_blocks=function(b,c){b=b.replace(/(\r\n|\n|\r)/g,"\n");var d=/([\s\S]+?)($|\n#|\n(?:\s*\n|$)+)/g,e=[],f,h=1;null!=(f=/^(\s*\n)/.exec(b))&&(h+=B(f[0]),d.lastIndex=f[0].length);for(;null!==(f=
d.exec(b));)"\n#"==f[2]&&(f[2]="\n",d.lastIndex--),e.push(l(f[1],f[2],h)),h+=B(f[0]);return e};g.prototype.processBlock=function(b,c){var d=this.dialect.block,e=d.__order__;if("__call__"in d)return d.__call__.call(this,b,c);for(var f=0;f<e.length;f++){var h=d[e[f]].call(this,b,c);if(h)return(!u(h)||0<h.length&&!u(h[0]))&&this.debug(e[f],"didn't return a proper array"),h}return[]};g.prototype.processInline=function(b){return this.dialect.inline.__call__.call(this,String(b))};g.prototype.toTree=function(b,
c){var d=b instanceof Array?b:this.split_blocks(b),e=this.tree;try{this.tree=c||this.tree||["markdown"];a:for(;d.length;){var f=this.processBlock(d.shift(),d);if(!f.length)continue a;this.tree.push.apply(this.tree,f)}return this.tree}finally{c&&(this.tree=e)}};g.prototype.debug=function(){var b=Array.prototype.slice.call(arguments);b.unshift(this.debug_indent);"undefined"!==typeof print&&print.apply(print,b);"undefined"!==typeof console&&"undefined"!==typeof console.log&&console.log.apply(null,b)};
g.prototype.loop_re_over_block=function(b,c,d){var e;for(c=c.valueOf();c.length&&null!=(e=b.exec(c));)c=c.substr(e[0].length),d.call(this,e);return c};g.dialects={};g.dialects.Gruber={block:{atxHeader:function(b,c){var d=b.match(/^(#{1,6})\s*(.*?)\s*#*\s*(?:\n|$)/);if(d){var e=["header",{level:d[1].length}];Array.prototype.push.apply(e,this.processInline(d[2]));d[0].length<b.length&&c.unshift(l(b.substr(d[0].length),b.trailing,b.lineNumber+2));return[e]}},setextHeader:function(b,c){var d=b.match(/^(.*)\n([-=])\2\2+(?:\n|$)/);
if(d){var e=["header",{level:"="===d[2]?1:2},d[1]];d[0].length<b.length&&c.unshift(l(b.substr(d[0].length),b.trailing,b.lineNumber+2));return[e]}},code:function(b,c){var d=[],e=/^(?: {0,3}\t| {4})(.*)\n?/;if(b.match(e)){a:do{var f=this.loop_re_over_block(e,b.valueOf(),function(b){d.push(b[1])});if(f.length){c.unshift(l(f,b.trailing));break a}else if(c.length){if(!c[0].match(e))break a;d.push(b.trailing.replace(/[^\n]/g,"").substring(2));b=c.shift()}else break a}while(1);return[["code_block",d.join("\n")]]}},
horizRule:function(b,c){var d=b.match(/^(?:([\s\S]*?)\n)?[ \t]*([-_*])(?:[ \t]*\2){2,}[ \t]*(?:\n([\s\S]*))?$/);if(d){var e=[["hr"]];d[1]&&e.unshift.apply(e,this.processBlock(d[1],[]));d[3]&&c.unshift(l(d[3]));return e}},lists:function(){function b(b){return new RegExp("(?:^("+s+"{0,"+b+"} {0,3})("+f+")\\s+)|(^"+s+"{0,"+(b-1)+"}[ ]{0,4})")}function c(b,c,d,e){if(c)b.push(["para"].concat(d));else for(c=b[b.length-1]instanceof Array&&"para"==b[b.length-1][0]?b[b.length-1]:b,e&&1<b.length&&d.unshift(e),
b=0;b<d.length;b++)e=d[b],"string"==typeof e&&1<c.length&&"string"==typeof c[c.length-1]?c[c.length-1]+=e:c.push(e)}function d(b,c){for(var d=new RegExp("^("+s+"{"+b+"}.*?\\n?)*$"),e=new RegExp("^"+s+"{"+b+"}","gm"),f=[];0<c.length;)if(d.exec(c[0])){var h=c.shift(),g=h.replace(e,"");f.push(l(g,h.trailing,h.lineNumber))}else break;return f}function e(b,c,d){b=b.list;b=b[b.length-1];b[1]instanceof Array&&"para"==b[1][0]||(c+1==d.length?b.push(["para"].concat(b.splice(1,b.length-1))):(c=b.pop(),b.push(["para"].concat(b.splice(1,
b.length-1)),c)))}var f="[*+-]|\\d+\\.",h=/[*+-]/,g=new RegExp("^( {0,3})("+f+")[ \t]+"),s="(?: {0,3}\\t| {4})";return function(f,t){function s(b){var c=h.exec(b[2])?["bulletlist"]:["numberlist"];m.push({list:c,indent:b[1]});return c}var n=f.match(g);if(n){var m=[],k=s(n),l,q=!1,r=[m[0].list],y;a:for(;;){var w=f.split(/(?=\n)/),v="",u=0;for(;u<w.length;u++){var C="",x=w[u].replace(/^\n/,function(b){C=b;return""}),n=b(m.length),n=x.match(n);if(void 0!==n[1]){v.length&&(c(l,q,this.processInline(v),
C),q=!1,v="");n[1]=n[1].replace(/ {0,3}\t/g,"    ");var z=Math.floor(n[1].length/4)+1;if(z>m.length)k=s(n),l.push(k),l=k[1]=["listitem"];else{var B=!1;for(y=0;y<m.length;y++)if(m[y].indent==n[1]){k=m[y].list;m.splice(y+1,m.length-(y+1));B=!0;break}B||(z++,z<=m.length?(m.splice(z,m.length-z),k=m[z-1].list):(k=s(n),l.push(k)));l=["listitem"];k.push(l)}C=""}x.length>n[0].length&&(v+=C+x.substr(n[0].length))}v.length&&(c(l,q,this.processInline(v),C),q=!1,v="");q=d(m.length,t);0<q.length&&(A(m,e,this),
l.push.apply(l,this.toTree(q,[])));q=t[0]&&t[0].valueOf()||"";if(q.match(g)||q.match(/^ /)){f=t.shift();if(q=this.dialect.block.horizRule(f,t)){r.push.apply(r,q);break}A(m,e,this);q=!0;continue a}break}return r}}}(),blockquote:function(b,c){if(b.match(/^>/m)){var d=[];if(">"!=b[0]){for(var e=b.split(/\n/),f=[],h=b.lineNumber;e.length&&">"!=e[0][0];)f.push(e.shift()),h++;f=l(f.join("\n"),"\n",b.lineNumber);d.push.apply(d,this.processBlock(f,[]));b=l(e.join("\n"),b.trailing,h)}for(;c.length&&">"==c[0][0];)e=
c.shift(),b=l(b+b.trailing+e,e.trailing,b.lineNumber);e=b.replace(/^> ?/gm,"");e=this.toTree(e,["blockquote"]);if((h=k(e))&&h.references){delete h.references;var g;a:{for(g in h)if(hasOwnProperty.call(h,g)){g=!1;break a}g=!0}g&&e.splice(1,1)}d.push(e);return d}},referenceDefn:function(b,c){var d=/^\s*\[(.*?)\]:\s*(\S+)(?:\s+(?:(['"])(.*?)\3|\((.*?)\)))?\n?/;if(b.match(d)){k(this.tree)||this.tree.splice(1,0,{});var e=k(this.tree);void 0===e.references&&(e.references={});d=this.loop_re_over_block(d,
b,function(b){b[2]&&"<"==b[2][0]&&">"==b[2][b[2].length-1]&&(b[2]=b[2].substring(1,b[2].length-1));var c=e.references[b[1].toLowerCase()]={href:b[2]};void 0!==b[4]?c.title=b[4]:void 0!==b[5]&&(c.title=b[5])});d.length&&c.unshift(l(d,b.trailing));return[]}},para:function(b,c){return[["para"].concat(this.processInline(b))]}}};g.dialects.Gruber.inline={__oneElement__:function(b,c,d){var e;c=c||this.dialect.inline.__patterns__;c=(new RegExp("([\\s\\S]*?)("+(c.source||c)+")")).exec(b);if(!c)return[b.length,
b];if(c[1])return[c[1].length,c[1]];c[2]in this.dialect.inline&&(e=this.dialect.inline[c[2]].call(this,b.substr(c.index),c,d||[]));return e=e||[c[2].length,c[2]]},__call__:function(b,c){function d(b){"string"==typeof b&&"string"==typeof e[e.length-1]?e[e.length-1]+=b:e.push(b)}for(var e=[],f;0<b.length;)f=this.dialect.inline.__oneElement__.call(this,b,c,e),b=b.substr(f.shift()),A(f,d);return e},"]":function(){},"}":function(){},__escape__:/^\\[\\`\*_{}\[\]()#\+.!\-]/,"\\":function(b){return this.dialect.inline.__escape__.exec(b)?
[2,b.charAt(1)]:[1,"\\"]},"![":function(b){var c=b.match(/^!\[(.*?)\][ \t]*\([ \t]*([^")]*?)(?:[ \t]+(["'])(.*?)\3)?[ \t]*\)/);return c?(c[2]&&"<"==c[2][0]&&">"==c[2][c[2].length-1]&&(c[2]=c[2].substring(1,c[2].length-1)),c[2]=this.dialect.inline.__call__.call(this,c[2],/\\/)[0],b={alt:c[1],href:c[2]||""},void 0!==c[4]&&(b.title=c[4]),[c[0].length,["img",b]]):(c=b.match(/^!\[(.*?)\][ \t]*\[(.*?)\]/))?[c[0].length,["img_ref",{alt:c[1],ref:c[2].toLowerCase(),original:c[0]}]]:[2,"!["]},"[":function(b){var c=
String(b),d=g.DialectHelpers.inline_until_char.call(this,b.substr(1),"]");if(!d)return[1,"["];var e=1+d[0],d=d[1];b=b.substr(e);var f=b.match(/^\s*\([ \t]*([^"']*)(?:[ \t]+(["'])(.*?)\2)?[ \t]*\)/);if(f){b=f[1];e+=f[0].length;b&&"<"==b[0]&&">"==b[b.length-1]&&(b=b.substring(1,b.length-1));if(!f[3])for(var c=1,h=0;h<b.length;h++)switch(b[h]){case "(":c++;break;case ")":0==--c&&(e-=b.length-h,b=b.substring(0,h))}b=this.dialect.inline.__call__.call(this,b,/\\/)[0];b={href:b||""};void 0!==f[3]&&(b.title=
f[3]);d=["link",b].concat(d);return[e,d]}return(f=b.match(/^\s*\[(.*?)\]/))?(e+=f[0].length,b={ref:(f[1]||String(d)).toLowerCase(),original:c.substr(0,e)},d=["link_ref",b].concat(d),[e,d]):1==d.length&&"string"==typeof d[0]?(b={ref:d[0].toLowerCase(),original:c.substr(0,e)},d=["link_ref",b,d[0]],[e,d]):[1,"["]},"<":function(b){var c;return null!=(c=b.match(/^<(?:((https?|ftp|mailto):[^>]+)|(.*?@.*?\.[a-zA-Z]+))>/))?c[3]?[c[0].length,["link",{href:"mailto:"+c[3]},c[3]]]:"mailto"==c[2]?[c[0].length,
["link",{href:c[1]},c[1].substr(7)]]:[c[0].length,["link",{href:c[1]},c[1]]]:[1,"<"]},"`":function(b){return(b=b.match(/(`+)(([\s\S]*?)\1)/))&&b[2]?[b[1].length+b[2].length,["inlinecode",b[3]]]:[1,"`"]},"  \n":function(b){return[3,["linebreak"]]}};g.dialects.Gruber.inline["**"]=w("strong","**");g.dialects.Gruber.inline.__=w("strong","__");g.dialects.Gruber.inline["*"]=w("em","*");g.dialects.Gruber.inline._=w("em","_");g.buildBlockOrder=function(b){var c=[],d;for(d in b)"__order__"!=d&&"__call__"!=
d&&c.push(d);b.__order__=c};g.buildInlinePatterns=function(b){var c=[],d;for(d in b)if(!d.match(/^__.*__$/)){var e=d.replace(/([\\.*+?|()\[\]{}])/g,"\\$1").replace(/\n/,"\\n");c.push(1==d.length?e:"(?:"+e+")")}c=c.join("|");b.__patterns__=c;var f=b.__call__;b.__call__=function(b,d){return void 0!=d?f.call(this,b,d):f.call(this,b,c)}};g.DialectHelpers={};g.DialectHelpers.inline_until_char=function(b,c){for(var d=0,e=[];;){if(b.charAt(d)==c)return d++,[d,e];if(d>=b.length)return null;var f=this.dialect.inline.__oneElement__.call(this,
b.substr(d)),d=d+f[0];e.push.apply(e,f.slice(1))}};g.subclassDialect=function(b){function c(){}function d(){}c.prototype=b.block;d.prototype=b.inline;return{block:new c,inline:new d}};g.buildBlockOrder(g.dialects.Gruber.block);g.buildInlinePatterns(g.dialects.Gruber.inline);g.dialects.Maruku=g.subclassDialect(g.dialects.Gruber);g.dialects.Maruku.processMetaHash=function(b){var c=b.split("");b=[""];for(var d=!1;c.length;){var e=c.shift();switch(e){case " ":d?b[b.length-1]+=e:b.push("");break;case "'":case '"':d=
!d;break;case "\\":e=c.shift();default:b[b.length-1]+=e}}c={};for(d=0;d<b.length;++d)/^#/.test(b[d])?c.id=b[d].substring(1):/^\./.test(b[d])?c["class"]=c["class"]?c["class"]+b[d].replace(/./," "):b[d].substring(1):/\=/.test(b[d])&&(e=b[d].split(/\=/),c[e[0]]=e[1]);return c};g.dialects.Maruku.block.document_meta=function(b,c){if(!(1<b.lineNumber)&&b.match(/^(?:\w+:.*\n)*\w+:.*$/)){k(this.tree)||this.tree.splice(1,0,{});var d=b.split(/\n/);for(p in d){var e=d[p].match(/(\w+):\s*(.*)$/),f=e[1].toLowerCase();
this.tree[1][f]=e[2]}return[]}};g.dialects.Maruku.block.block_meta=function(b,c){var d=b.match(/(^|\n) {0,3}\{:\s*((?:\\\}|[^\}])*)\s*\}$/);if(d){var e=this.dialect.processMetaHash(d[2]);if(""===d[1]){var f=this.tree[this.tree.length-1],d=k(f);if("string"===typeof f)return;d||(d={},f.splice(1,0,d));for(a in e)d[a]=e[a];return[]}d=b.replace(/\n.*$/,"");f=this.processBlock(d,[]);d=k(f[0]);d||(d={},f[0].splice(1,0,d));for(a in e)d[a]=e[a];return f}};g.dialects.Maruku.block.definition_list=function(b,
c){var d=/^((?:[^\s:].*\n)+):\s+([\s\S]+)$/,e=["dl"],f;if(b.match(d)){for(var h=[b];c.length&&d.exec(c[0]);)h.push(c.shift());for(var g=0;g<h.length;++g){f=h[g].match(d);var l=f[1].replace(/\n$/,"").split(/\n/),k=f[2].split(/\n:\s+/);for(f=0;f<l.length;++f)e.push(["dt",l[f]]);for(f=0;f<k.length;++f)e.push(["dd"].concat(this.processInline(k[f].replace(/(\n)\s+/,"$1"))))}return[e]}};g.dialects.Maruku.block.table=function(b,c){var d=function(b,c){c=c||"\\s";c.match(/^[\\|\[\]{}?*.+^$]$/)&&(c="\\"+c);
for(var d=[],e=new RegExp("^((?:\\\\.|[^\\\\"+c+"])*)"+c+"(.*)"),f;f=b.match(e);)d.push(f[1]),b=f[2];d.push(b);return d},e=/^ {0,3}(\S(?:\\.|[^\\|])*\|.*)\n {0,3}([\-:]+\s*\|[\-| :]*)\n((?:(?:\\.|[^\\|])*\|.*(?:\n|$))*)(?=\n|$)/,f,g;if(g=b.match(/^ {0,3}\|(.+)\n {0,3}\|\s*([\-:]+[\-| :]*)\n((?:\s*\|.*(?:\n|$))*)(?=\n|$)/))g[3]=g[3].replace(/^\s*\|/gm,"");else if(!(g=b.match(e)))return;var l=["table",["thead",["tr"]],["tbody"]];g[2]=g[2].replace(/\|\s*$/,"").split("|");var k=[];A(g[2],function(b){b.match(/^\s*-+:\s*$/)?
k.push({align:"right"}):b.match(/^\s*:-+\s*$/)?k.push({align:"left"}):b.match(/^\s*:-+:\s*$/)?k.push({align:"center"}):k.push({})});g[1]=d(g[1].replace(/\|\s*$/,""),"|");for(f=0;f<g[1].length;f++)l[1][1].push(["th",k[f]||{}].concat(this.processInline(g[1][f].trim())));A(g[3].replace(/\|\s*$/mg,"").split("\n"),function(b){var c=["tr"];b=d(b,"|");for(f=0;f<b.length;f++)c.push(["td",k[f]||{}].concat(this.processInline(b[f].trim())));l[2].push(c)},this);return[l]};g.dialects.Maruku.inline["{:"]=function(b,
c,d){if(!d.length)return[2,"{:"];c=d[d.length-1];if("string"===typeof c)return[2,"{:"];b=b.match(/^\{:\s*((?:\\\}|[^\}])*)\s*\}/);if(!b)return[2,"{:"];d=this.dialect.processMetaHash(b[1]);var e=k(c);e||(e={},c.splice(1,0,e));for(var f in d)e[f]=d[f];return[b[0].length,""]};g.dialects.Maruku.inline.__escape__=/^\\[\\`\*_{}\[\]()#\+.!\-|:]/;g.buildBlockOrder(g.dialects.Maruku.block);g.buildInlinePatterns(g.dialects.Maruku.inline);var u=Array.isArray||function(b){return"[object Array]"==Object.prototype.toString.call(b)},
A;A=Array.prototype.forEach?function(b,c,d){return b.forEach(c,d)}:function(b,c,d){for(var e=0;e<b.length;e++)c.call(d||b,b[e],e,b)};r.renderJsonML=function(b,c){c=c||{};c.root=c.root||!1;var d=[];if(c.root)d.push(x(b));else for(b.shift(),!b.length||"object"!==typeof b[0]||b[0]instanceof Array||b.shift();b.length;)d.push(x(b.shift()));return d.join("\n\n")}})(function(){return"undefined"===typeof exports?(window.markdown={},window.markdown):exports}());